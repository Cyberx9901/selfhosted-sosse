{% extends "se/base.html" %}
{% load static %}

{% block head %}
    <script type="text/javascript" src="{% static "se/index.js" %}"></script>
{% endblock %}

{% block css %}
    .search-form {
        text-align: center;
        padding: 10px;
    }
    .res-head {
        padding-top: 10px;
    }
    .res-img {
        height: 16px;
        width: 16px;
        display: inline;
    }
    .res-title {
        margin-bottom: 0px;
        display: inline;
    }
    .res-url {
        text-decoration: none;
        color: #080;
        font-size: 13px;
    }
    .res-rank {
        font-size: 10px;
        display: inline;
    }
    .pagination {
        padding: 20px 0px 20px 0px;
    }

    #more {
        text-decoration: none;
        font-size: 13px;
    }

    #adv_search {
        padding-top: 20px;
    }

    .adv_search {
        padding-bottom: 5px;
    }

    #word_stats {
        float: right;
        text-align: left;
        overflow-y: scroll;
        height: 300px;
        border-left-width: 1px;
        border-left-style: solid;
        border-color: black;
    }
{% endblock %}

{% block body %}
    <form method="get" class="search-form" id="search_form">
        {% for field in form.hidden_fields %}
            {{ field }}
        {% endfor %}

        {% for field in form.visible_fields %}
            {# {{ field.label }} #}{{ field }}
        {% endfor %}
        <input type="submit" value="ðŸ”Ž" onclick="return on_submit()">
        <div id="more_div">
            <a id="more" href="#" onclick="search_more()">+ more</a>
        </div>
    
        <template id="adv_search_tmpl">
            <input class="dyn_button" type="button" value="+">
            <input class="dyn_button" type="button" value="-">
            <select name="ft">
                <option value="inc">Keep</option>
                <option value="exc">Exclude</option>
            </select>
            <select name="ff">
                <option value="doc">Document</option>
                <option value="content">Content</option>
                <option value="title">Title</option>
                <option value="url">Url</option>
            </select>
            <select name="fo">
                <option value="contain">Containing</option>
                <option value="equal">Equal to</option>
                <option value="regexp">Matching Regexp</option>
            </select>
            <input name="fv" type="text">
            <input name="fc" type="checkbox">
            <label for="case">Case sensitive</label>
        </template>
        
        <div id="adv_search" style="display: none">
            <select id="doc_lang" name="doc_lang">
                <option value="">Any</option>
                {% for key, val in settings.MYSE_LANGDETECT_TO_POSTGRES.items %}
                    <option value="{{ key }}">{{ val.flag }} {{ val.name|title }}</option>
                {% endfor %}
            </select>
        </div>
    </form>

    {% if results %}
        <hr/>
        {{ results|length }} result{{ results|pluralize:"s" }}
        <button style="float: right" onclick="return show_word_stats()">ðŸ“Š</button>
        <br/>
        <div id="word_stats" style="display: none">
            <div style="text-align: center">Word stats</div>
            <table id="word_stats_table">
                <tr>
                    <th>Word</th>
                    <th>Docs</th>
                </tr>
            </table>
        </div>
        {% for r in paginated %}
            <div class="res-head">
                {% if r.favicon and not r.favicon.missing %}
                    <img class="res-img" src="{% url 'favicon' r.favicon.id %}" alt="icon">
                {% endif %}
                <a href="{{ r.url }}">
                    <h3 class="res-title">{{ r.title }}</h3>
                </a>
            </div>
            <a href="{{ r.url }}" class="res-url">
                {{ r.url }}
            </a>
            <div class="res-rank">/ {{ r.rank|floatformat:"1" }}</div>
            <div class="res-rank">{{ r.lang_iso_639_1 }}</div>
            <div class="res-rank">{{ r.id }}</div>
            <br/>
            <div class="headline">{{ r.headline }}</div>
        {% endfor %}

        <div class="pagination">
            <span class="step-links">
                {% if paginated.has_previous %}
                    <a href="{{ page_first }}">&laquo; first</a>
                    <a href="{{ page_previous }}">previous</a>
                {% endif %}

                <span class="current">
                    Page {{ paginated.number }} of {{ paginated.paginator.num_pages }}.
                </span>

                {% if paginated.has_next %}
                    <a href="{{ page_next }}">next</a>
                    <a href="{{ page_last }}">last &raquo;</a>
                {% endif %}
            </span>
        </div>
    {% endif %}
{% endblock %}
