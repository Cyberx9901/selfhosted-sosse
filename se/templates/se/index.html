{% extends "se/base.html" %}
{% load static %}

{% block head %}
    <script type="text/javascript" src="{% static "se/index.js" %}"></script>
{% endblock %}

{% block css %}
    .search-form {
        text-align: center;
        padding: 10px;
    }
    .res {
        margin: 6px 0px 6px 0px;
        padding: 10px 10px 10px 10px;
        border-radius: 10px;
    }
    .res:hover {
        background-color: #f4f4f4;
    }
    .res-img {
        height: 16px;
        width: 16px;
        display: inline;
    }
    .res-title {
        margin-bottom: 0px;
        display: inline;
    }
    .res-url {
        text-decoration: none;
        color: #080;
        font-size: 13px;
    }
    .res-rank {
        font-size: 10px;
        display: inline;
    }
    .res-headline {
        text-decoration: none;
        color: #000;
    }
    .pagination {
        padding: 20px 0px 20px 0px;
        text-align: center;
    }

    #more {
        color: #000;
        text-decoration: none;
        font-size: 13px;
    }

    #adv_search {
        padding-top: 20px;
    }
    #stats_menu {
        right: 8px;
        width: 160px;
        top: 135px;
    }
    #word_stats {
        float: right;
        text-align: left;
        overflow-y: scroll;
        height: 300px;
        width: 250px;
    }
    #word_stats_list {
        list-style-type: none;
        margin: 0;
        padding: 0;
    }
    .word_stats_txt {
        width: 90%;
        margin-right: -8px;
        padding: 2px 0px 2px 8px;
        display: inline;
    }
    .links:hover .word_stats_txt {
        background-color: #e7f0ff;
    }
    .word_stats_count {
        width: 10%;
        text-align: right;
        display: inline;
    }
    .links:hover .word_stats_count {
        background-color: #e7f0ff;
    }
    .dyn_button {
        width: 38px;
        text-align: center;
    }
    #search_button {
        background-image: url('{% static "se/icon-search.svg" %}');
    }
    #stats_button {
        background-image: url('{% static "se/icon-stats.svg" %}');
    }
{% endblock %}

{% block top_bar %}
    <form method="get" id="search_form">
        <div class="search-form">
            {% for field in form.hidden_fields %}
                {{ field }}
            {% endfor %}

            {{ form.q }}

            <input id="search_button" class="img_button" type="submit" value=" " onclick="return on_submit()">
            <div id="more_div">
                <a id="more" href="#" onclick="search_more()">⮟ advanced</a>
            </div>
        </div>

        <template id="adv_search_tmpl">
            <input class="dyn_button" type="button" value="+">
            <input class="dyn_button" type="button" value="-">
            <select name="ft">
                <option value="inc">Keep</option>
                <option value="exc">Exclude</option>
            </select>
            <select name="ff">
                <option value="doc">Document</option>
                <option value="content">Content</option>
                <option value="title">Title</option>
                <option value="url">Url</option>
            </select>
            <select name="fo">
                <option value="contain">Containing</option>
                <option value="equal">Equal to</option>
                <option value="regexp">Matching Regexp</option>
            </select>
            <input name="fv" type="text">
            <input name="fc" type="checkbox">
            <label for="case">Case sensitive</label>
        </template>
        
        <div id="adv_search" style="display: none">
            <div>
                Language
                <select id="doc_lang" name="doc_lang">
                    <option value="">Any</option>
                    {% for key, val in myse_langdetect_to_postgres.items %}
                        <option value="{{ key }}">{{ val.flag }} {{ val.name|title }}</option>
                    {% endfor %}
                </select>

                Sort {{ form.s }}
            </div>
        </div>
    </form>
{% endblock %}

{% block body %}
    {% if results %}
        <div>
            {{ results_count }} result{{ results|pluralize:"s" }}
        </div>
        <div class="menu" id="stats_menu">
            <button id="stats_button" class="menu_button img_button" onclick="return show_word_stats()">
            </button>
            <div id="word_stats" class="panel">
                <ul id="word_stats_list">
                    <li>
                        <div>
                            Document's word statistics
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        {% for r in paginated %}
            <div class="res">
                <div>
                    {% if r.favicon and not r.favicon.missing %}
                        <img class="res-img" src="{% url 'favicon' r.favicon.id %}" alt="icon">
                    {% endif %}
                    <a href="{{ r.url }}">
                        <h3 class="res-title">{{ r.title }}</h3>
                    </a>
                </div>
                <a href="{{ r.url }}" class="res-url">
                    {{ r.url }}
                </a>
                <div class="res-rank">/ {{ r.rank|floatformat:"1" }}</div>
                <div class="res-rank">{{ r.lang_iso_639_1 }}</div>
                <div class="res-rank">{{ r.id }}</div>
                <div class="res-rank"><a href="{% url 'www' r.url %}">cached</a></div>
                <br/>
                <a href="{{ r.url }}" class="res-headline">{{ r.headline }}</a>
            </div>
        {% endfor %}

        {% if paginated.paginator.num_pages %}
            <div class="pagination">
                <div style="padding-bottom: 15px">
                    {{ paginated.number }} of {{ paginated.paginator.num_pages }}
                </div>
                <div>
                    {% if paginated.has_previous %}
                        <a class="a_button" href="{{ page_previous }}">Prev</a>
                    {% else %}
                        <a class="a_button a_button_disabled" onclick="return false">Previous</a>
                    {% endif %}
                        ·
                    {% if paginated.has_next %}
                        <a class="a_button" href="{{ page_next }}">Next</a>
                    {% else %}
                        <a class="a_button a_button_disabled" onclick="return false">Next</a>
                    {% endif %}
                </div>
            </div>
        {% endif %} {# paginated.paginator.num_pages #}
    {% endif %}
{% endblock %}
